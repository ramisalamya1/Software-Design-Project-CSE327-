<h2>All Reviews</h2>

<!-- Filter Form -->
<form method="get">
    <label for="hospital">Hospital:</label>
    <select name="hospital" id="hospital">
        <option value="">All Hospitals</option>
        {% for hospital in hospitals %}
            <option value="{{ hospital.id }}" {% if hospital.id|stringformat:"s" == request.GET.hospital %}selected{% endif %}>
                {{ hospital.name }}
            </option>
        {% endfor %}
    </select>

    <label for="doctor">Doctor:</label>
    <select name="doctor" id="doctor">
        <option value="">All Doctors</option>
        {% for doctor in doctors %}
            <option value="{{ doctor.id }}" {% if doctor.id|stringformat:"s" == request.GET.doctor %}selected{% endif %}>
                {{ doctor.name }}
            </option>
        {% endfor %}
    </select>

    <label for="service_quality">Service Quality:</label>
    <select name="service_quality" id="service_quality">
        <option value="">All Ratings</option>
        {% with "12345"|make_list as ratings %}
            {% for i in ratings %}
                <option value="{{ i }}" {% if i == request.GET.service_quality %}selected{% endif %}>
                    {{ i }}
                </option>
            {% endfor %}
        {% endwith %}
    </select>

    <label for="anonymous">Anonymity:</label>
    <select name="anonymous" id="anonymous">
        <option value="">All</option>
        <option value="1" {% if request.GET.anonymous == '1' %}selected{% endif %}>Anonymous</option>
        <option value="0" {% if request.GET.anonymous == '0' %}selected{% endif %}>Not Anonymous</option>
    </select>

    <button type="submit">Filter</button>
</form>

{% if average_rating %}
    <p><strong>Average Service Quality Rating:</strong> {{ average_rating|floatformat:1 }}/5</p>
{% endif %}

<!-- Reviews List -->
{% for review in reviews %}
  <div style="border: 1px solid #ccc; padding: 10px; margin: 15px 0;">
    <p><strong>
      {% if review.anonymous %}
        Anonymous
      {% else %}
        {{ review.user.username }}
      {% endif %}
    </strong> 
    on {{ review.created_at|date:"Y-m-d H:i" }}</p>
    
    <p><strong>Patient ID:</strong> {{ review.patient_id }}</p> <!-- âœ… Added Patient ID -->

    <p><strong>Hospital:</strong> {{ review.hospital.name }}</p>
    {% if review.doctor %}<p><strong>Doctor:</strong> {{ review.doctor.name }}</p>{% endif %}

    <p><strong>Service Quality:</strong> {{ review.service_quality }}/5</p>
    <p><strong>Cost Transparency:</strong> {{ review.cost_transparency }}/5</p>
    <p><strong>Facility Standards:</strong> {{ review.facility_standards }}/5</p>
    <p><strong>Treatment Effectiveness:</strong> {{ review.treatment_effectiveness }}/5</p>

    <p><strong>Average Rating:</strong> {{ review.average_rating|floatformat:1 }}/5</p>

    <p><strong>Review:</strong> {{ review.text }}</p>

    {% if review.is_editable %}
    <a href="{% url 'edit_review' review.pk %}">Edit</a> |
    <a href="{% url 'delete_review' review.pk %}">Delete</a>
    {% endif %}

    <!-- Flag option -->
    {% if not review.already_flagged %}
    <a href="{% url 'flag_review' review.pk %}">Flag this review</a>
    {% endif %}
  </div>
{% empty %}
  <p>No reviews yet.</p>
{% endfor %}
